---
title: "统计学-基于R课后解答"
author: "河北经贸大学17级统计学专业所有同学,其中修订为怪力奶酪、子衿,网络技术为弯仔马头、十四行诗"
date: "2020年2月"
site: bookdown::bookdown_site
output: bookdown::gitbook
description: "这是用R的bookdown功能制作中文图书的模板，输出格式为bookdown::gitbook和bookdown::pdf_book."
documentclass: book
biblio-style: apalike
# bibliography: [mybib.bib]
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
#install.packages(c("repmis","plotrix","vioplot","fmsb","aplpack","DescTools","TeachingDemos","agricolae","pastecs","BSDA","car","psych",lm.beta","forecast","R.cache","R.methodsS3","R.oo","R.utils"))
```
Reading a Rdata file from github
```{r}
library(repmis)
```
# 第一章
## 下面是按收入五等划分的我国农村平均收入数据（单位：元）
### 在R中录入上表数据，并存为R格式
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch1/exercise1_1.RData?raw=True")
head(exercise1_1,10)
```

### 将上述数据框转换为矩阵
```{r}
aver_income=as.matrix(exercise1_1[,2:6])
aver_income
rownames(aver_income)=exercise1_1[,1]
aver_income
colnames(aver_income)=gsub("X","",colnames(aver_income))
aver_income
```

## 下表是2014年我国各地区的地区生产总值数据
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch1/exercise1_2.RData?raw=True")
head(exercise1_2,10)
```
### 按地区生产总值多少进行升序和降序排序
```{r}
gdp2014=exercise1_2
gdp2014_increasing=gdp2014[order(gdp2014$"地区生产总值"),]
gdp2014_decreasing=gdp2014[order(-gdp2014$"地区生产总值"),]
head(gdp2014_increasing,10)
head(gdp2014_decreasing,10)
```
### 将地区生产总值重新命名为GDP,并存为R数据格式
```{r}
library(repmis)
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch1/exercise1_2.RData?raw=True")
exercise112=c(exercise1_2)
exercise112
```
### 分别采用有放回抽样和无放回抽样两种方式各随机抽取6个地区作为样本
```{r}
sample(exercise1_2$地区,6,replace = FALSE)
sample(exercise1_2$地区,6,replace = TRUE)
```
### 分别筛选出地区生产总值小于2万亿元和大于5万亿元的地区
```{r}
sample(exercise1_2$地区[exercise1_2$GDP<20000])
sample(exercise1_2$地区[exercise1_2$GDP>50000])
```
## 用R生产20个标准正态分布随机数，将其组织成4*5和5*4的矩阵
```{r}
rnorm(20)
y<-rnorm(20)
matrix1_3=matrix(y,nrow=4,ncol=5)
matrix1_3
matrix1_4=matrix(y,nrow=5,ncol=4)
matrix1_4
```
# 第二章 数据的可视化
## 为了了解消费者对不同行业的满意度，随机调查120个消费者，得到如下数据
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_1.RData?raw=True")
head(exercise2_1,10)
```
### 生成简单频数分布表、二维列联表和三维列联表
```{r}
summary(exercise2_1)
```

### 生成行业和性别的二维列联表
```{r}
table1=table(exercise2_1$"行业",exercise2_1$"性别")
addmargins(table1)
```

### 生成行业和满意度的二维列联表
```{r}
table2=table(exercise2_1$"行业",exercise2_1$"满意度")
addmargins(table2)
```

### 生成性别和满意度的二维列联表
```{r}
table3=table(exercise2_1$"性别",exercise2_1$"满意度")
addmargins(table3)
```

### 生成三维列联表
```{r}
table4=ftable(exercise2_1)
table4
```

### 分别绘制关于行业、性别和满意度的条形图
```{r}
load("c:/exercise/ch2/exercise2_1.RData")
count1<-table(exercise2_1$行业)
count2<-table(exercise2_1$性别)
count3<-table(exercise2_1$满意度)
par(mfrow=c(1,3),pin=c(1.2,1.2),cex=0.7,cex.main=0.8)
bar<-barplot(count1,xlab="频数",ylab="行业",horiz=TRUE,xlim=c(0,1.2*max(count1)),main="(a)水平条形图",col=2:5)
text(bar,count1,labels=count1,pos=4,adj=c(0,0.5))
bar<-barplot(count2,xlab="性别",ylab="频数",col=c("gray40","gray80"),ylim=c(0,1.2*max(count2)),main="(b)垂直条形图")
 text(bar,count2,labels=count2,pos=3,col=2)
 bar<-barplot(count3,xlab="满意度",ylab="频数",ylim=c(0,1.1*max(count3)),col=2:3,main="(c)垂直条形图")
text(bar,count3/2,labels=count3,pos=3,col=4)
```

### 绘制不同行业满意度人数的帕累托图
```{r}
count1=table(exercise2_1$"行业")
par(pin=c(3,2),cex=0.8)
x=sort(count1,decreasing=T)
bar<-barplot(x,xlab="行业",ylab="频数",col=rainbow(4),ylim=c(0,1.2*max(count1)))
text(bar,x,labels=x,pos=3,col=1)
y<-cumsum(x)/sum(x)
par(new=T)
plot(y,type="b",lwd=1.5,pch=15,axes=FALSE,xlab='',ylab='',main='')
axis(4)
mtext("累积频率",side=4,line=3,cex=.8)
mtext("累积分布曲线",line=-2.5,cex=.8,adj=0.75)
```

### 复式条形图---行业和满意度
```{r}
mytable1=table(exercise2_1$"满意度",exercise2_1$"行业")
par(pin=c(3,2),cex=0.6)
bar1<-barplot(mytable1,xlab="行业",ylab="频数",ylim=c(0,30),col=c("pink","lightblue"),legend=rownames(mytable1),args.legend=list(x=9),,beside=T)
text(bar1,mytable1,labels=mytable1,pos=3,col=1)
```

### 复式条形图---性别和满意度
```{r,fig.height = 3, fig.width = 4}
mytable2=table(exercise2_1$"满意度",exercise2_1$"性别")
mytable2
par(mai=c(0.5,0.5,0.1,0.1),cex=0.6)
bar2=barplot(mytable2,xlab="性别",ylab="频数",ylim=c(0,45),col=c("lightblue","pink"),legend=rownames(mytable2),args.legend=list(x=4),beside=T)
text(bar2,mytable2,labels=mytable2,pos=3,col=2)
```

### 绘制马赛克图
```{r,fig.height = 3, fig.width = 4}
par(pin=c(2.5,2.5),cex=0.8)
mosaicplot(~性别+行业+满意度,data=exercise2_1,color=2:3,main="")
```

### 绘制饼图和扇形图对各类别的百分比进行分析
```{r, fig.height = 3, fig.width = 4}
count1<-table(exercise2_1$行业)
name<-names(count1)
percent<-prop.table(count1)*100
label1<-paste(name," ",percent,"%",sep="")
par(pin=c(3,2),pin=c(3,2),cex=0.8)
pie(count1,labels=label1,init.angle=90,radius=1)
```

### 绘制扇形图
```{r, fig.height = 3, fig.width = 4}
name<-names(count1)
percent<-count1/sum(count1)*100
percent=round(percent,2)
labs<-paste(name," ",percent,"%",sep="")
library(plotrix)
fan.plot(mar=c(0.7,0.7,0.5,0.3),count1,labels=labs,ticks=10)

```

 分析：在调查的120个消费者中，其中31.67%的消费者对电信行业满意度做出评价，仅15.83%的消费者对航空业，满意度做出评价。电信行业受众广，被调查者在该四个行业中接触最多的也是电信行业，易做出评价，而航空业与大多数居民无直接关系，接触较少故较不容易做出评价。

## 灯泡使用寿命测试（单位：小时）
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_2.RData?raw=True")
head(exercise2_2,10)
```

### 将数据分为10组，生成频数分布表
```{r}
vector2_2<-as.vector(exercise2_2$"灯泡寿命")
d=table(cut(vector2_2,breaks=150*(18:28),right=FALSE))
df=data.frame(d)
df
percent=df$Freq/sum(df$Freq)*100
cumsump=cumsum(percent)
mytable=data.frame(d,percent,cumsump)
mytable
```

### 绘制直方图
```{R, fig.height = 2, fig.width = 3}
load("C:/exercise/ch2/exercise2_2.RData")
d<-exercise2_2$灯泡寿命
par(cex=0.7,mai=c(0.6,0.6,0.2,0.1))
hist(d,ylim=c(0,30),labels=T,xlab="小时",ylab="频数",main="灯泡使用寿命直方图")
```

### 绘制茎叶图
```{R}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_2.RData?raw=True")
stem(exercise2_2$灯泡寿命)
```

分析：由茎叶图可直观看出，灯泡使用寿命最小值为2700小时，最大使用寿命为4169小时。其中，灯泡使用寿命集中在3500—3700小时之间。

## 下面是我国10个城市2006年各月份的气温数据

### 按城市绘制箱线图和小提琴图
```{R,fig.height = 3, fig.width = 5}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_3.RData?raw=True")
par(mai=c(0.5,0.5,0.2,0.2))
boxplot(exercise2_3,col="pink",ylab="气温",xlab="城市",cex.lab=.8,cex.axis=.7,main="气温")
library(vioplot)
x1=exercise2_3$"北京"
x2=exercise2_3$"沈阳"
x3=exercise2_3$"上海"
x4=exercise2_3$"南昌"
x5=exercise2_3$"郑州"
x6=exercise2_3$"武汉"
x7=exercise2_3$"广州"
x8=exercise2_3$"海口"
x9=exercise2_3$"重庆"
x10=exercise2_3$"昆明"
vioplot(x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,col="lightblue",names=c("北京","沈阳","上海","南昌","郑州","武汉","广州","海口","重庆","昆明"),pin=c(2,1.5))
```

### 按城市绘制点图和核密度估计曲线
```{r,,fig.height = 3, fig.width = 4}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_3_1.RData?raw=True")
par(mai=c(.8,.8,.1,.1),cex=.8)
dotchart(exercise2_3_1$气温,groups=
exercise2_3_1$城市,xlab="气温",pch=12,col="brown")
```

### 按城市绘制轮廓图和雷达图
```{r,fig.height = 3, fig.width = 4}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_3.RData?raw=True")
par(mai=c(.7,.7,.1,.1),cex=.8)
matplot(t(exercise2_3[2:11]),type='b',lty=1:12,col=rainbow(12),lwd=2,xlab="城市",ylab ="气温",pch=1,xaxt="n")
axis(side=1,at=2:11,labels=c("北京","沈阳","上海","南昌","郑州","武汉","广州","海口","重庆","昆明"),cex.axis=0.7)
legend(x="topright",legend=exercise2_3[,1],lty=1:12,col=rainbow(12),text.width=2,cex=0.8)
```

### 绘制雷达图
```{r,fig.height = 3, fig.width = 4}
par(mai=c(0.5,0.5,0.5,0.5),cex=0.8)
library(fmsb)
radarchart(exercise2_3[,2:11],axistype=0,seg=4,maxmin=FALSE,vlabels=names(exercise2_3[,2:11]),pcol=rainbow(7),plwd=3)
legend(x="topleft",legend=c("北京","沈阳","上海","南昌","郑州","武汉","广州","海口","重庆","昆明"),col=1:10,lwd=1,text.width=0.5,cex=0.7)

```

### 分别按月份和城市绘制星图和脸谱图
```{r, fig.height = 4, fig.width = 6}
matrix2_3=as.matrix(exercise2_3[,2:11])
rownames(matrix2_3)=exercise2_3[,1] 
stars(matrix2_3,key.loc=c(10,2,5),cex=0.8,main='不同月份的星图')
```

### 按月份绘制星图
```{r,fig.height = 5, fig.width =7}
stars(t(matrix2_3),full=F,draw.segments=TRUE,key.loc=c(10,1.85,5),cex=0.8,main='不同城市的星图')
```

### 绘制脸谱图
```{r, fig.height = 3, fig.width = 4}
library(aplpack)
faces(matrix2_3,nrow.plot=3,ncol.plot=4,face.type=3,main='不同月份的脸谱图')
faces(t(matrix2_3),nrow.plot=2,ncol.plot=5,face.type=0,main='不同城市的脸谱图')
```

## 下表是2011年我国31个地区的地区生产总值（按收入法计算）、全社会固定资产投资和最终消费支出数据（单位：亿元）
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_4.RData?raw=True")
head(exercise2_4,10)
```

### 绘制散点图和气泡图分析各变量之间的关系

### 散点图
```{r, fig.height = 3, fig.width = 4}
attach(exercise2_4)
par(mai=c(0.7,0.8,0.1,0.1),cex=0.6)
plot(固定资产投资,地区生产总值,xlab="",ylab="地区生产总值")
abline(lm(地区生产总值~固定资产投资,data=exercise2_4),lty=2)
points(最终消费支出,地区生产总值,pch=2,col="blue")
abline(lm(地区生产总值~最终消费支出,data=exercise2_4),col="blue",lty=3)
legend(0, 54000, c("对固定资产投资回归", "对最终消费支出回归"),col = c("black","blue"),lty = c(2, 3))
```

### 绘制气泡图
```{r, fig.height = 3, fig.width = 4}
par(mai=c(0.9,0.9,0.1,0.1))
r<- sqrt(地区生产总值/pi) 
symbols(固定资产投资,最终消费支出,circles=r,inches=0.3,fg="white",bg="lightblue", ylab="最终消费支出",xlab="固定资产投资",ylim=c(0,35000),xlim=c(0,30000))
text(固定资产投资,最终消费支出,rownames(exercise2_4),cex=0.6)
mtext("气泡大小 = 地区生产总值",line=-1,cex=.8,adj=0.1)
```

### 绘制星图和脸谱图比较31个地区各项数据的相似性

### 按城市绘制星图
```{r, fig.height = 3, fig.width = 3}
matrix2_4=as.matrix(exercise2_4[,2:4])
rownames(matrix2_4)=exercise2_4[,1] 
stars(t(matrix2_4),full=F,draw.segments=TRUE,key.loc=c(10,1.85,5),cex=0.8,main='各指标星图')
```

### 脸谱图
```{r, fig.height = 2.8, fig.width = 4}
library(aplpack)
faces(t(matrix2_4),nrow.plot=1,ncol.plot=3,face.type=0,main='各指标的脸谱图',cex=0.9)
```

## 下表是2005年—2014年我国城镇居民和农村居民的CPI数据
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_5.RData?raw=True")
exercise2_5
```

### 绘制时间序列图，观察居民和农村居民消费价格指数的变化特征
```{r, fig.height = 3, fig.width = 4}
par(mai=c(0.7,0.7,0.1,0.1),cex=0.8,fg=2) 
plot(exercise2_5[,2],lwd=2,ylim=c(100,110),xlab="年份",ylab="居民消费水平",type="n")
grid(col="gray60")
points(exercise2_5[,2],type='o',lwd=2,ylim=c(100,110),xlab="年份",ylab="居民消费水平")
lines(exercise2_5[,3],type='b',lty=2,lwd=2,col="blue")
legend(x="topleft",legend=c("城镇居民","农村居民"),lty=1:2,col=c(1,3),cex=0.8)
```

  分析：2005年—2014年农村居民的消费价格指数整体上略高于城市，说明农村经济目前增速大于城市。但无论城市亦或农村CPI变化程度不大，说明物价相对稳定。

## 假定某地区不同收入阶层的人口数和不同阶层人口的年收入额如下表所示。绘制洛伦兹曲线分析收入分配的不平等程度。

### 绘制洛伦兹曲线分析收入分配的不平等程度
```{r, fig.height = 3, fig.width = 4}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch2/exercise2_6.RData?raw=True")
exercise2_6
library(DescTools)
Lc(exercise2_6$"不同阶层人口数的收入额",exercise2_6$"不同收入阶层的人口数")
par(mai=c(0.7,0.7,0.4,0.1),cex=0.8)
plot(Lc(exercise2_6$"不同阶层人口数的收入额",exercise2_6$"不同收入阶层的人口数"),xlab="人数比例",ylab="收入比例",col=4,panel.first=grid(10,10,col="gray70"))
```

  分析：洛伦兹曲线弯曲程度较大，远离平均线，表示收入分配的不平等程度较大。

# 第三章 数据的描述统计量

## 50个消费者网购金额
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch3/exercise3_1.RData?raw=True")
head(exercise3_1,10)
```

### 计算平均数、标准差、极差和四分位数
```{r}
mean(exercise3_1$"网购金额")
sd(exercise3_1$"网购金额")
range=max(exercise3_1$"网购金额")-min(exercise3_1$"网购金额")
range
IQR(exercise3_1$"网购金额",type=6)
```

### 计算10%，25%，50%，75%，90%的分位数
```{r}
quantile(exercise3_1$"网购金额",probs=c(0.1,0.25,0.5,0.75,0.90),type=6)
```

### 计算标准分数检测离群点

### 计算标准分数并将结果保留四位小数
```{r}
a=round(scale(exercise3_1$"网购金额"),4)
```

### 方法筛选离群点
```{r}
subset(exercise3_1,网购金额>(3*sd(exercise3_1$"网购金额")+mean(exercise3_1$"网购金额"))|网购金额<((-3)*sd(exercise3_1$"网购金额")+mean(exercise3_1$"网购金额")))
```

### 计算偏度系数和峰度系数，分析网购金额的分布特点

### 计算偏度系数
```{r}
library(agricolae)
skewness(exercise3_1$"网购金额")
kurtosis(exercise3_1$"网购金额")
```
  分析：偏度系数为0.6633，属于中等偏斜分布，右偏分布。峰度系数为1.2203>0，为尖峰分布，数据相对集中。

## 计算统计量及画箱线图
```{r, fig.height = 3, fig.width = 4}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch3/exercise3_2.RData?raw=True")
library(pastecs)
round(stat.desc(exercise3_2),4)
par(mfrow=c(1,3),cex=0.6,mai=c(0.7,0.7,0.1,0.1))
boxplot(exercise3_2$"方法A",col="lightblue",xlab="方法A",ylab="产品数量",cex.lab=0.8,cex.axis=0.6)
boxplot(exercise3_2$"方法B",col="lightblue",xlab="方法B",ylab="产品数量",cex.lab=0.8,cex.axis=0.6)
boxplot(exercise3_2$"方法C",col="lightblue",xlab="方法C",ylab="产品数量",cex.lab=0.8,cex.axis=0.6)
```

## 在大学生中随机抽取50名男生和50名女生，测得身高数据如下
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch3/exercise3_3.RData?raw=True")
head(exercise3_3,10)
```

### 绘制背靠背茎叶图，计算有关描述性统计量，比较男女生身高的特点和差异

### 背靠背茎叶图
```{r}
library(aplpack)
stem.leaf.backback(exercise3_3$"男生",exercise3_3$"女生")
```

### 计算各统计量
```{r}
library(pastecs)
round(stat.desc(exercise3_3),4)
```
 
  分析：由男生和女生的背靠背茎叶图可以看出，女生身高集中在160cm-175cm之间，而男生身高集中在170cm-190cm之间。分别计算男女生身高的统计量，男生平均身高为178.56，女生平均身高为167.856。比较而言，男生身高标准差为6.6579，大于女生身高标准差，所以男生之间身高差异较大。

# 第四章 随机变量的概率分布

## 消费者协会经过调查发现，某品牌冷气机重要缺陷的产品数出现的概率分布如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch4/exercise4_1.RData?raw=True")
exercise4_1
```
### 有2~5台（包括2台与5台在内）冷气机出现重要缺陷的概率
```{r}
p1<-0.209	
p2<-0.223
p3<-0.178
p4<-0.114
p<-p1+p2+p3+p4
p
```

### 只有不到2台冷气机出现重要缺陷的概率
```{r}
p1<-0.041
p2<-0.130
pp<-p1+p2
pp
```
### 有超过5台冷气机出现重要缺陷的概率
```{r}
p1<-0.061
p2<-0.028
p3<-0.011
p4<-0.004
p5<-0.001
ppp<-p1+p2+p3+p4+p5
ppp
```
## 设X是参数为n=4和p=0.1的二项随机变量，求以下概率
### P(X=2)
```{r}
dbinom(2,4,0.1) 
```
### P(X≤1)
```{r}
pbinom(1,4,0.1) 
```
## 计算以下概率和分位点
### 4.3.1 X~N(500,20²);P(X≥510);P(400≤X≤450)
```{r}
1-pnorm(510,mean=500,sd=20)
pnorm(450,mean=500,sd=20)-pnorm(400,mean=500,sd=20)
```
### Z~N(0,1);P(0≤Z≤1.2);P(-0.48≤Z≤0);P(Z≥1.2)
```{r}
pnorm(1.2,mean=0,sd=1)-pnorm(0,mean=0,sd=1)
pnorm(0,mean=0,sd=1)-pnorm(-0.48,mean=0,sd=1)
1-pnorm(1.2,mean=0,sd=1)
```
### 标准正态分布累计频率为0.95时的反函数值z
```{r}
qnorm(0.475,mean=0,sd=1)
```
## 计算以下概率和分位点：
### X~t(df),df=15,t值小于-1.5的概率；df=20，t值大于2的概率；df=30,t分布右尾概率0.05时的t值
```{r}
pt(-1.5,df=15)
1-pt(2,df=20)
qt(0.95,df=30)
```

### X~Chi-square(df),df=8,$\chi^2$值小于12的概率；df=20,$\chi^2$值大于18的概率;df=15.$\chi^2$分布右尾概率为0.025时的反函数值.
```{r}
pchisq(12,df=8)
1-pchisq(18,df=20)
qchisq(0.975,df=15)
```
## 抽取不同的样本量模拟以下分布
### 正态分布，来自正态总体的样本
```{r, fig.height = 3, fig.width = 4}
par(mai=c(0.75,0.75,0.1,0.1),cex=0.9)
curve(dnorm(x,0,sqrt(1/2)),from=-3,to=3,xlim=c(-4,4),ylab="f(x)",lty=1,col=2,lwd=3)
abline(h=0)
segments(0,0,0,0.56,col="blue",lty=2,lwd=1.5)
curve(dnorm(x,mean=0,sd=1),from=-4,to=4,add=TRUE,lty=2,lwd=3)
curve(dnorm(x,0,sqrt(2)),from=-4,to=4,add=TRUE,lty=3,col=4,lwd=3)
legend(x="topright",legend=c("N(0,0.5)","N(0,1)","N(0,2)"),inset=0.001,lty=1:3,col=c(2,"black",4))
```


### 样本均值的分布，来自任意总体的样本
```{r, fig.height = 4, fig.width = 5}
par(mfrow=c(1,3),mai=c(0.7,0.7,0.4,0.2),cex=0.8)
x<-vector()
n=10
for(i in 1:1000){
  x<-append(x,mean(sample(100,n,replace=F)))
}
head(x,100)
hist(x,prob=T,xlim=c(0,100),ylim=c(0,0.05),col="lightblue",xlab="样本均值",main="样本均值的分布",cex.main=.8)
lines(density(x),col="red",lwd=2)
x<-vector();m<-vector()
n=30
for(i in 1:1000){
  x<-append(x,mean(sample(100,n,replace=F)))
}
head(x,100)
hist(x,prob=T,xlim=c(0,100),ylim=c(0,0.1),col="lightblue",xlab="样本均值",main="样本均值的分布",cex.main=.8)
lines(density(x),col="red",lwd=2)
x<-vector();m<-vector()
n=50
for(i in 1:1000){
  x<-append(x,mean(sample(100,n,replace=F)))
}
head(x,100)
hist(x,prob=T,xlim=c(0,100),ylim=c(0,0.15),col="lightblue",xlab="样本均值",main="样本均值的分布",cex.main=.8)
lines(density(x),col="red",lwd=2)
```


### 样本比例的分布，来自任意总体的样本
```{r, fig.height = 3, fig.width = 5}
par(mai=c(1.2,1.2,0.5,0.5))
p=rbinom(1000,1000,.2)/1000
head(p,100)
hist(p,prob=T,xlim=c(0.1,0.3),ylim=c(0,34),col="lightblue",xlab="样本比例",main="模拟样本比例的分布",cex.main=.8)
lines(density(p),col="red",lwd=2)
```

### 样本方差的分布，来自正态总体的样本
```{r, fig.height = 3, fig.width = 5}
v<-vector()
n=30
for(i in 1:1000){
  v<-append(v,var(rnorm(n)))
}
hist(v,prob=T,xlim=c(0,2),ylim=c(0,1.8),col="lightblue",xlab="样本方差",main="模拟样本方差的分布",cex.main=.8)
lines(density(v),col="red",lwd=2)
```


# 第五章 参数估计
## 某快餐店想要估计每位顾客午餐的平均花费金额,在为期3周的时间里选取49名顾客组成了一个简单随机样本,得到样本均值为120元，标准差为15元，求总体均值μ的95％的置信区间。
```{r}
xbar=120
s=15
n=49
q=qnorm(0.975)
LCI=xbar-q*s/sqrt(n)
UCI=xbar+q*s/sqrt(n)
data.frame(LCI,UCI)
```
## 利用下面的信息，构建总体均值μ的置信区间
### 总体服从正态分布。已知标准差\sigma=500，n=15，样本均值=8900。置信水平为95%
```{r}
xbar=8900
sigma=500
n=15
q=qnorm(0.975)
LCI=xbar-q*sigma/sqrt(n)
UCI=xbar+q*sigma/sqrt(n)
data.frame(LCI,UCI)
```


### 总体不服从正态分布.已知\sigma=500，n=35，样本均值=8900。置信水平为95%.
```{r}
xbar=8900
sigma=500
n=35
q=qnorm(0.975)
LCI=xbar-q*sigma/sqrt(n)
UCI=xbar+q*sigma/sqrt(n)
data.frame(LCI,UCI)
```


### 总体不服从正态分布。已知\sigma未知，n=35，样本均值=8900，s=510。置信水平为90%
```{r}
xbar=8900
s=510
n=35
q<-qnorm(0.95)
LCI=xbar-q*s/sqrt(n)
UCI=xbar+q*s/sqrt(n)
data.frame(LCI,UCI)
```
### 总体不服从正态分布。已知\sigma未知，n=100，样本均值=8900，s=510。置信水平为95%
```{r}
xbar=8900
s=500
n=100
q=qnorm(0.975)
LCI=xbar-q*s/sqrt(n)
UCI=xbar+q*s/sqrt(n)
data.frame(LCI,UCI)
```

## 某大学为了了解学生每天上网的时间，在全校学生中随机抽取36人，调查他们每天的上网时间，得到的数据如下（单位：小时）：求该校大学生平均上网时间的置信区间，置信水平分别为90%，95%和99%。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch5/exercise5_3.RData?raw=True")
head(exercise5_3,10)
```

```{r}
library(BSDA)
z.test(exercise5_3$"上网时间",mu=0,sigma.x=sd(exercise5_3$"上网时间"),conf.level=0.90)
z.test(exercise5_3$"上网时间",mu=0,sigma.x=sd(exercise5_3$"上网时间"),conf.level=0.95)
z.test(exercise5_3$"上网时间",mu=0,sigma.x=sd(exercise5_3$"上网时间"),conf.level=0.99)
```

## 某居民小区共有居民500户，小区管理者准备采取一项新的供水设施，想了解居民是否赞成。采取重复抽样方法随机抽取了50户，其中有32户赞成，18户反对。估计总体中赞成采用新设施的户数比例的置信区间，置信水平为95％。
```{r}
n<-50
x<-32
p<-x/n
q<-qnorm(0.975)
LCI<-p-q*sqrt(p*(1-p)/n)
UCI<-p+q*sqrt(p*(1-p)/n)
data.frame(LCI,UCI)
```
## 为比较哪种排队方式使顾客等待的时间更短，银行各随机抽取10名顾客,他们在办理业务时所等待的时间(单位:分钟)如下:
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch5/exercise5_5.RData?raw=True")
exercise5_5
```
### 构建第一种排队方式等待时间均值的95%的置信区间
```{r}
library(BSDA)
z.test(exercise5_5$方式1,mu=0,sigma.x=sd(exercise5_5$方式1),conf.level=0.95)
```


### 构建第二种排队方式等待时间方差的95%的置信区间
```{r}
library(TeachingDemos)
sigma.test(exercise5_5$"方式2",conf.level=0.95)$conf.int
```


### 构建两种方式排队时间均值之差的95%的置信区间

### 方差相等
```{r}
t.test(x=exercise5_5$方式1,y=exercise5_5$方式2,var.equal=TRUE)$conf.int
```
### 方差不相等
```{r}
t.test(x=exercise5_5$方式1,y=exercise5_5$方式2,var.equal=F)$conf.int
```
## 根据已有数据构建两个正太分布总体

### 计算$μ_1$-$μ_2$的95%的置信区间
```{r}
x<-rnorm(14,53.2,96.8)
y<-rnorm(7,43.4,102.0)
t.test(x,y,var.equal=TRUE,conf.level=0.95)$conf.int
```


### 计算$μ_1$-$μ_2$的99%的置信区间
```{r}
x<-rnorm(14,53.2,96.8)
y<-rnorm(7,43.4,102.0)
t.test(x,y,var.equal=TRUE,conf.level=0.99)$conf.int
```
## 一家人才测评机构对随机抽取的10名小企业的经理人用两种方法进行的信心测试，得到的自信心测试分数如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch5/exercise5_7.RData?raw=True")
exercise5_7
```


 构建两种方法平均自信心得分之差$μ_d$=$μ_1$-$μ_2$的95%的置信区间
```{r}
t.test(exercise5_7$方法1,exercise5_7$方法2,paired=TRUE)$conf.int
```

## 从两个总体中各抽取一个$n_1$=$n_2$=250的独立随机样本，来自总体1的样本比例为$p_1$=40%，来自总体2的样本比例为$p_2$=30%
### 5.8.1构造$π_1$-$π_2$=90%的置信区间
```{r}
n1<-250
n2<-250
p1<-0.4
p2<-0.3
q<-qnorm(0.95)
LCI<-p1-p2-q*sqrt(p1*(1-p1)/n1+p2*(1-p2)/n2)
UCI<-p1-p2+q*sqrt(p1*(1-p1)/n1+p2*(1-p2)/n2)
data.frame(LCI,UCI) 
```


### 构造$π_1$-$π_2$=95%的置信区间
```{r}
n1<-250
n2<-250
p1<-0.4
p2<-0.3
q<-qnorm(0.975)
LCI<-p1-p2-q*sqrt(p1*(1-p1)/n1+p2*(1-p2)/n2)
UCI<-p1-p2+q*sqrt(p1*(1-p1)/n1+p2*(1-p2)/n2)
data.frame(LCI,UCI)
```
## 生产工序的方差是工序质量的一个重要度量。当方差较大时，需要对工序进行改进以减小方差。下面是两部机器生产的袋茶重量(单位：g)的数据：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch5/exercise5_9.RData?raw=True")
head(exercise5_9,10)
```


 构造两个总体方差比$σ_1$²/$σ_2$²的95%的置信区间
```{r}
var.test(exercise5_9$机器1,exercise5_9$机器2,alternative="two.sided")$conf.int
```
# 第六章 假设检验

## 一种机床加工的零件尺寸绝对平均误差为1.35mm，生产厂家准备采用一种新的机床以进一步降低误差，为检测新机床加工的零件平均误差与旧机床相比是否有显著降低，从新机床生产的零件中随机抽取50个进行检验。50个零件尺寸的绝对误差数据（单位：mm）如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_1.RData?raw=True")
head(exercise6_1,10)
```

### 绘制Q-Q图，检验零件尺寸的绝对误差是否服从正态分布
```{r, fig.height = 2, fig.width = 3}
par(cex=0.8,mai=c(0.7,0.7,0.2,0.1))
qqnorm(exercise6_1$"零件误差",xlab="期望正态值",ylab="观测值",datax=TRUE,main="正态Q-Q图")
qqline(exercise6_1$"零件误差",datax=TRUE,col="red")
```

  分析：根据Q-Q图可直观看出，有较多观测点远离直线，故其不服从正态分布。
  
### 检验新机床加工的零件尺寸的平均误差与旧机床相比是否有显著降低（α=0.01）
```{r}
library(BSDA)
ks.test(exercise6_1$零件误差,"pnorm", mean(exercise6_1$零件误差), sd(exercise6_1$零件误差))
```

  分析：P值=0.004579＜α=0.01，所以拒绝原假设，认为绝对误差有显著降低。
  
## 安装于一种联合收割机的金属板的平均重量为25千克。对某企业生产的20块金属板进行测量。得到的重量数据如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_2.RData?raw=True")
head(exercise6_2,10)
```

### 采用Shapiro-Wilk检验和K-S检验两种方法，检验该企业生产的金属板的重量是否服从正态分布（α=0.05）

### Shapiro-Wilk检验
```{r}
shapiro.test(exercise6_2$重量)              
```
  
  分析：H₀：金属板的重量服从正态分布。H₁：金属板的重量不服从正态分布，经Shapiro-Wilk检验可得，W=0.97064,p值=0.7684，p>0.05,所以不能拒绝原假设，认为金属板的重量服从正态分布。

### K-S检验
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_2.RData?raw=True")
ks.test(exercise6_2$重量,"pnorm", mean(exercise6_2$重量), sd(exercise6_2$重量))
```

  分析：经K-S检验可得，D=0.10808，p值=0.9539，p>0.05,所以接受原假设，认为金属板的重量服从正态分布。

### 假定全属板的重量服从正态分布，检验该企业生产的金属板是否符合要求（α=0.05）
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_2.RData?raw=True")
t.test(exercise6_2$重量,mu = 25)
```

  分析:H₀:金属板的重量平均数μ＝25。H₁：金属板的重量平均数μ≠25,经t检验，得到mean of x=25.51,t=-5.627,df=19，p值=0.3114，p>0.05,拒绝原假设，有证据显示该企业生产的金属板不符合要求。

### 计算效应量，分析差异程度。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_2.RData?raw=True")
sd(exercise6_2$重量)
```

分析：得到样本标准差s=2.193267，效应量d=|mean of x-x|/s=0.23252983，结果表示：样本金属板的平均重量与标准重量相差0.23252983，因为0.20≤d<0.50,为小的效应值。

## 下表是样本中每个人都分别在看过该产品的新的电视广告之前与之后打分
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_3.RData?raw=True")
exercise6_3
```

### 两个总体均值之差的假设检验
```{r}
t.test(exercise6_3$看后 , exercise6_3$看前,paired = TRUE,alternative = "greater")
```


  结论：在该项检验中，p值=0.1084>0.05,所以不能拒绝原假设，即认为“看后”平均得分小于或等于“看前”平均得分。

## 下表是两种方法对员工培训的效果得到的测试分数结果的数据
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_4.RData?raw=True")
head(exercise6_4,10)
```

### 假定方差相等（α=0.05）
```{r}
t.test(exercise6_4$方法1,exercise6_4$方法2,var.equal = TRUE)
```

  分析：由配对样本t检验，H₀:两种方法的培训效果没有显著差异。H₁:两种方法的培训效果有显著差异。p-value = 2.444e-06<0.05,拒绝原假设，所以认为两种方法的培训效果有显著差异。

### 假定方差不相等
```{r}
t.test(exercise6_4$方法1,exercise6_4$方法2,var.equal = FALSE)
```

  结论：由配对样本t检验，H₀:两种方法的培训效果没有显著差异。H₁:两种方法的培训效果有显著差异。p-value = 2.568e-06<0.05,拒绝原假设，所以认为两种方法的培训效果有显著差异
  
### 计算效应量，分析差异程度
```{r}
library(lsr)
cohensD(exercise6_4$方法1,exercise6_4$方法2)
```

  结论：效应量:d值=2.151704，表示方法1的均值（𝜇~1~）与方法2的均值（𝜇~2~）相差2.151704个标准差，效应量较大。

## 生产商随机抽取550人作为样本，其中115人早餐喝牛奶，验证该城市的人早产饮用牛奶的比例是够高于17%。检验该生产商的说法是否属实（α=0.05）
```{r}
n=550
p <- 115/550
pi0=0.17
z <- (p-pi0)/sqrt(pi0*(1-pi0)/n)
p_value <-1-pnorm(z)
data.frame(z,p_value)
```

  结论:H₀: P<=0.17，H₁:P>0.17。检验得p=0.007<0.05，拒绝原假设，认为生产商的说法属实。

## 随机抽取100女经理中有24人认为自己成功，95男经理中39人认为自己成功，检验男女认为自己成功比例是否有显著差异。
```{r}
n1=100
n2=95
p1=0.24
p2=0.41
p=(p1*n1+p2*n2)/(n1+n2)
z=(p1-p2)/sqrt(p*(1-p)*(1/n1+1/n2))
p_value=pnorm(z)
p_value1=2*p_value
data.frame(z, p_value1)
```

  结论：H₀:男女经理认为自己成功的人数无显著差异，H₁:男女经理认为自己成功的人数有显著差异。p<0.05,拒绝原假设，即认为男女经理认为自己成功的人数有显著差异。

## 土壤相同40块地，各20块用新旧两种肥料得到的产量表
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_7.RData?raw=True")
head(exercise6_7,10)
```
### 新肥料平均产量是否显著高于旧肥料，方差相等前提下。
```{r}
t.test(exercise6_7$新肥料,exercise6_7$旧肥料,var.equal=TRUE,alternative="greater")
```

  结论：H₀:使用新肥料的产量均值≤使用旧肥料产量均值，H₁:使用新肥料的产量的均值>使用旧肥料产量均值。p=1.737e-06<0.05，拒绝原假设，统计意义上认为新肥料产量明高于于旧肥料产量，所以应该使用新肥料。


### 两种肥料产量方差是否有显著差异
```{r}
var.test(exercise6_7[,1],exercise6_7[,2])
```

  结论：H₀:两种肥料产量的方差无显著差异，H₁两种肥料产量的方差有显著差异。根据检验p=0.4862>0.05，不能拒绝原假设，认为两种肥料产量的方差无显著性差异。
  
### 计算效应量，分析差异程度。
```{r}
library(lsr)
 cohensD(exercise6_7$旧肥料,exercise6_7$新肥料)
```

  结论：新肥料与旧肥料的效应量为1.716202，即新肥料与旧肥料均值相差 1.716202个标准差，效应量较大。
  
## 生产工序中的方差是工序质量的一个重要指标。通常较大的方差就意味着要通过寻找减小工序方差的途径来改进工作。某杂志上刊载了两台机器生产的袋茶重量的数据（单位：克）如下：检验这两部机器生产的袋茶重量的方差是否存在显著差异（ɑ=0.05）。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_8.RData?raw=True")
var.test(exercise6_8[,1],exercise6_8[,2],alternative="two.sided")
```

  结论：由两个总体的方差检验，H₀:两机器生产的袋茶重量的的方差无显著差异.H₁：两机器生产的袋茶重量的的方差有显著差异。p值=1.477e-06<0.05.拒绝原假设，即认为两机器生产的袋茶重量的的方差有显著差异。

## 为了解一种节能灯的使用寿命，随机抽取了10只灯泡，测得其使用寿命（单位：小时）如下：采用Wilcoxon符号秩检验检验该种节能灯使用寿命的中位数是否等于6000小时（ɑ=0.05）。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_9.RData?raw=True")
 wilcox.test(exercise6_9$寿命,m = 6000)
```

  结论：由Wilcoxon符号秩检验，H₀:使用寿命的中位数等于6000。H₁:使用寿命的中位数不等于6000。p值=0.1934>0.05，因此不能拒绝原假设，即认为使用寿命的中位数的等于6000.
  
## 某种品牌的彩电在两个城市销售，在A城市和B城市各有8个商场销售。下表是各商场一年的销售量（单位：台）。采用Mann-Whitney检验分析两个城市的销售量是否有显著差异（ɑ=0.05）。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_10.RData?raw=True")
 attach(exercise6_10)
 wilcox.test(A城市,B城市)
```

  结论：由Mann-Whitney检验，H₀:两个城市的销售量无显著差异。H₁：两个城市的销售量由显著差异。p值=0.5992>0.05，不能拒绝原假设，即认为两个城市的销售量无显著差异

## 为分析股票的每股盈利状况，在某证券市场上随机抽取10只股票，得到上年度和本年度的每股盈利（单位：元）数据如下表所示，采用Wilcoxon符号秩检验分析：本年度与上年度相比，每股盈利是否有显著提高（ɑ=0.05）。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch6/exercise6_11.RData?raw=True")
 attach(exercise6_11)
 wilcox.test(上年度,本年度,paired=TRUE)
```

  结论：由两个配对样本的Wilcoxon符号秩检验，H₀:本年度与上年度相比，每股盈利无显著提高；H₁:本年度与上年度相比，每股盈利有显著提高。由SPSS的Wilcoxon符号秩检验，α=0.05，得到p值=0.08293。p/2=0.041465<0.05,拒绝原假设，即认为本年度与上年度相比，每股盈利有显著提高。

# 第七章 类别变量分析
## 一家食品生产企业想了解过去一年中各个月份的销售量是否符合均匀分布，以便更好地安排生产。企业的市场销售部门收集的过去一年中每个月的销售量数据如下：
 检验各个月份的销售量是否符合均匀分布（α=0.05）
 H₀：各个月份的销售量符合均匀分布 
 H₁：各个月份的销售量不符合均匀分布
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch7/exercise7_1.RData?raw=True")
exercise7_1
chisq.test(exercise7_1$销售量)
```


 p-value=9.778e-13<0.05,则拒绝原假设，统计意义上认为各个月份的销售量不符合均匀分布。

## 为研究大学生的逃课情况，一个研究小组做了一次调查，得到男女生逃课情况的汇总表如下：检验是否逃课与学生性别是否独立（α=0.05）
 H₀：是否逃课与学生性别独立 
 H₁：是否逃课与学生性别不独立
```{r}
x<-c(34,28,38,50) 
M<-matrix(x,nr=2,nc=2,byrow=TRUE,dimnames=list(c("男","女"),c("逃过课","没逃过课")))
chisq.test(M)
```
 p-value=0.2145＞0.05,故不能拒绝原假设，即不能认为是否逃课与学生性别不独立。

## 为研究上市公司对其股价波动的关注程度，一家研究机构对在主板、中小板、创业板上市的190家公司进行了调查，检验上市公司的类型与对股价波动的关注程度是否独立。
```{r}
x<-c(50,70,30,15,20,5) 
M<-matrix(x,nr=3,nc=2,byrow=TRUE,dimnames=list(c("主板企业","中小板企业","创业板企业"),c("关注","不关注")))
M
chisq.test(M)
```
 H₀：上市公司的类型与对股价波动的关注程度独立

 H₁：上市公司的类型与对股价波动的关注程度不独立

 由检验结果可知p-value = 0.0002189<0.05，拒绝H₀，认为上市公司的类型与对股价波动的关注程度不独立。

## 一家汽车企业的销售部门对北部地区、中部地区和南部地区的400个消费者做了抽烟调查，检验地区与汽车价格是否独立。
```{r}
y<-c(20,40,40,50,50,60,30,20,20,40,10,20) 
N<-matrix(y,nr=4,nc=3,byrow=TRUE,dimnames=list(c("10万元以下","10万~20万元","20~30万元","30万元以上"),c("北部地区","南部地区","中部地区")))
N
chisq.test(N)
```
 H₀：地区与汽车价格独立

 H₁：地区与汽车价格不独立

 由检验结果可知p-value = 3.946e-05<0.05，拒绝H₀，认为地区与汽车价格不独立。

## 计算习题7.3中上市公司的类型对股价波动的关注程度两个变量之间的phi系数、Crammer's系数和列联系数，并分析其相关程度。
```{r}
library(vcd)
x=c(50,70,30,15,20,5)
M=matrix(x,nrow=3,ncol=2,byrow=T,dimnames=list(c("主板企业","中小板企业","创业板企业"),c("关注","不关注")))
M
assocstats(M)
```
 分析：phi系数只用于2*2列联表，故没有结果。Crammer's系数V=0.298，列联系数C=0.298，表明上市公司的类型与对股价波动的关注程度有一定的相关性。

## 计算习题7.4中地区与汽车价格两个变量之间的phi系数、Crammer's系数和列联系数，并分析其相关程度。
```{r}
library(vcd)
y<-c(20,40,40,50,50,60,30,20,20,40,10,20) 
N<-matrix(y,nr=4,nc=3,byrow=TRUE,dimnames=list(c("10万元以下","10万~20万元","20~30万元","30万元以上"),c("北部地区","南部地区","中部地区")))
N
assocstats(N)
```

 分析：phi系数只用于2*2列联表，故没有结果。Crammer's系数V=0.194，列联系数C=0.264，表明上市公司的类型与对股价波动的关注程度有一定的相关性。


# 第八章 方差分析

## 一家牛奶公司有4台机器装填牛奶,每桶的容量为4L

### 检验机器对装填量是否有显著性影响。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_1.RData?raw=True")
head(exercise8_1,10)
attach(exercise8_1)
model_1w<-aov(填装量~机器)
summary(model_1w)
model_1w$coefficients
```

 H₀:机器对装填量的影响不显著
 H₁:机器对装填量的影响显著
 由分析结果可知，p=0.0135>0.01，不拒绝H₀，即不能认为机器对装填量的影响显著。

### 分析效应量。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_1.RData?raw=True")
attach(exercise8_1)
library(DescTools)
model_1w<-aov(填装量~机器)
EtaSq(model_1w,anova=T)
```

 由效应量结果$\eta^2$=0.4070206可知，组间差异较大。

### 分别采用LSD方法和HSD方法比较哪些机器的装填量之间存在显著差异。
```{r}
library(DescTools)
PostHocTest(model_1w,method="lsd")
```

 H₀：$n_i$=$n_j$
 H₁：$n_i$≠$n_j$
 由LSD分析结果可知：                                 
 机器2-机器1的p-value=0.2225>0.05,不拒绝H₀，即不能认为机器2与机器1之间有显著差异；        

 机器3-机器1的p-value=0.0016<0.05,拒绝H₀,认为机器3与机器1之间有显著差异；                  

 机器4-机器1的p-value=0.1772>0.05,不拒绝H₀，即不能认为机器4与机器1之间有显著差异；           
 机器3-机器2的p-value=0.0275<0.05,拒绝H₀,认为机器3与机器2之间有显著差异；    

 机器4-机器2的p-value=0.8901>0.05,不拒绝H₀，即不能认为机器4与机器2之间有显著差异；           
 机器4-机器3的p-value=0.0367<0.05,拒绝H₀,认为机器4与机器3之间有显著差异；

```{r}
PostHocTest(model_1w,method="hsd")
```

 H₀:$n_i$=$n_j$
 H₁:$n_i$≠$n_j$

 由HSD分析结果可知：

 机器2-机器1的p-value=0.5982>0.05,不拒绝H₀，即不能认为机器2与机器1之间有显著差异；

 机器3-机器1的p-value=0.0082<0.05,拒绝H₀,认为机器3与机器1之间有显著差异；   

 机器4-机器1的p-value=0.5144>0.05,不拒绝H₀，即不能认为机器4与机器1之间有显著差异；           
 机器3-机器2的p-value=0.1140>0.05,不拒绝H₀，即不能认为机器3与机器2之间有显著差异；           
 机器4-机器2的p-value=0.9990>0.05,不拒绝H₀，即不能认为机器4与机器2之间有显著差异；           
 机器4-机器3的p-value=0.1471>0.05,不拒绝H₀，即不能认为机器4与机器3之间有显著差异；


### 检验装填量是否满足正态性和方差齐性。
### shapiro正态性检验
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_1.RData?raw=True")
attach(exercise8_1)
shapiro.test(填装量)
```

 H₀：填装量服从正态分布
 H₁：填装量不服从正态分布
 由shapiro正态性检验可知，p-value = 0.7912>0.05,不拒绝H₀,可以认为填装量服从正态分布。


### Batrlett-检验
```{r}
bartlett.test(填装量~机器,data=exercise8_1)
```

 H₀:各个总体方差相同
 H₁:所有总体方差中至少两个方差不同
 由Batrlett-方差齐性检验可知，p-value = 0.7073>0.05，不拒绝H₀，可以认为各个总体方差相同。

## 一家管理咨询公司为不同的客户举办人力资源管理讲座。每次讲座的内容基本上是一样的，但讲座的听课者，有时是高级管理者，有时是中级管理者，有时是低级管理者。该咨询公司认为，不同层次的管理者对讲座的满意度是不同的，对听完讲座后随机抽取的不同层次管理者的满意度评分如下（评分标准从1——10，10代表非常满意）：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_2.RData?raw=True")
exercise8_2
```
### 检验管理者的水平不同是否会导致评分的显著差异（α=0.05），并分析效应量。
 H₀：管理者的水平不同不会导致评分的显著差异
 H₁：管理者的水平不同会导致评分的显著差异
```{r}
attach(exercise8_2)
model_1w<-aov(评分~管理者)
summary(model_1w)
```

 p-value = 0.000633<0.05,则拒绝H₀，认为管理者的水平不同会导致评分的显著差异。
```{r}
library(DescTools)
attach(exercise8_2)
model_1w<-aov(评分~管理者)
EtaSq(model_1w,anova=T)
```
 效应量= 0.6254296，则表明组间差异较大

### 分别采用LSD方法和HSD方法比较管理者之间评分的差异
```{r}
library(agricolae)
model_1w<-aov(评分~管理者,data=exercise8_2)
LSD<-LSD.test(model_1w,"管理者");LSD
```
 结果显示如下：
 中层管理者 9.000000      a
 高层管理者 7.666667      a
 低层管理者 5.833333      b
 认为中层管理者和高层管理者之间差异不显著，低层管理者和中层管理者、低层管理者和高层管理者之间差异显著。
```{r}
library(agricolae)
HSD<-HSD.test(model_1w,"管理者");HSD
```
 分析：认为中层管理者和高层管理者之间差异不显著，低层管理者和中层管理者、低层管理者和高层管理者之间差异显著。

### 检验满意度评分是否满足正态性和方差齐性。
### 正态性：
 H₀：总体满足正态分布
 H₁：总体不满足正态分布
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_2.RData?raw=True")
attach(exercise8_2)
shapiro.test(评分)
```
 p-value = 0.3063>0.05,则不能拒绝原假设，认为总体满足正态分布。
### 方差齐性
 H₀：$\sigma_1^2$=$\sigma_2^2$=⋯=$\sigma_I^2$
 H₁：$\sigma_1^2$、$\sigma_2^2$、⋯、$\sigma_I^2$至少两个方差不同
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_2.RData?raw=True")
library(car)
leveneTest(评分~管理者,exercise8_2)
```
 p-value =0.2857>0.05，则不拒绝H₀，认为满意度评分满足方差齐性


### 假定不同层次管理者的满意度评分不满足方差分析的假定。采用Kruskal-Wallis检验进行分析。
 H₀:所有总体都相同
 H₁:并非所有总体都相同
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_2.RData?raw=True")
attach(exercise8_2)
kruskal.test(评分~管理者)
```
 p-value = 0.004623<0.05，则拒绝H₀，认为并非所有总体都相同；

## 某家店制造公司准备购进一批电池，现有A，B，C三个电池生产企业愿意供货，为此校他们生产的电池质量，从每个企业各随机抽取5节电池
### 8.3.1分析3个企业生产的电池平均寿命之间有无显著差异(α=0.05)，并分析效应量。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_3.RData?raw=True")
exercise8_3
attach(exercise8_3)
model_3w<-aov(电池寿命~企业)
summary(model_3w)
```

 H₀:3个企业生产的电池平均寿命之间无显著差异
 H₁:3个企业生产的电池平均寿命之间有显著差异
 由分析结果可知，p=0.00031<0.05，拒绝H₀，3个企业生产的电池平均寿命之间有显著差异。
```{r}
library(DescTools)
model_3w<-aov(电池寿命~企业)
EtaSq(model_3w,anova=T)
```
 由效应量结果$\eta^2$=0.7399038可知，组间差异较大。 

### 如果有差异，用HSD方法检验哪些企业之间有差异
```{r}
PostHocTest(model_3w,method="hsd")
```
 H₀:$n_i$=$n_j$
 H₁:$n_i$≠$n_j$
 由HSD分析结果可知：
 B-A的p-value=0.00046<0.05，拒绝H₀，认为B企业与A企业之间有显著差异；
 C-A的p-value=0.78473>0.05，不拒绝H₀，不能认为C企业与A企业之间有显著差异；
 C-B的p-value=0.00140<0.05，拒绝H₀，认为C企业与B企业之间有显著差异；


## 有5个不同品种的种子和4个不同的施肥方案。在20块同样面积的土地上分别采用5个不同品种的种子和4个不同的施肥方案进行试验
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_4.RData?raw=True")
exercise8_4
```

### 检验不同品种和施肥量方案对产量的影响是否显著（α=0.05）
 H₀：不同品种和施肥量方案对产量的影响不显著
 H₁：不同品种和施肥量方案对产量的影响显著
```{r}
attach(exercise8_4)
model_2wm<-aov(收获量~品种+施肥方案)
summary(model_2wm)
```
 分析：品种p-value=0.00332<0.05，施肥方案p-value=0.00195 <0.05则拒绝H₀，认为不同品种和施肥量方案对产量的影响显著

### 计算偏效应量并进行分析
```{r}
model_2wm<-aov(收获量~品种+施肥方案)
library(DescTools)
EtaSq(model_2wm,anova=T)
```
 品种$\eta^2$=0.4223081，则表明组间差异较大
 施肥方案$\eta^2$= 0.4026955，则表明组间差异较大

## 城市道路交通管理部门为研究不同路段和不同时间段对行车时间的影响，让一名交通警察分别在3个路段和高峰期与非高峰期亲自驾车进行实验，通过实验并获得30个行车时间数据。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_5.RData?raw=True")
head(exercise8_5,15)
```

### 分析路段时段以及路段和时段的交互作用对行车时间的影响（α=0.05）
```{r}
attach(exercise8_5)
fit<- aov(行车时间~时段 + 路段 + 时段:路段)
summary(fit)
```
 检验时段的假设：
 H₀:时段对行车时间无显著影响
 H₁:时段对行车时间有显著影响

 检验路段的假设：
 H₀:路段对行车时间无显著影响
 H₁:路段对行车时间有显著影响

 检验时段与路段交互作用的假设：
 H₀:时段和路段的交互作用对行车时间无显著影响
 H₁:时段和路段的交互作用对行车时间有显著影响

 由交互效应方差分析的结果可知：

 时段$P_a$=1.36*10^(-8)<0.05,拒绝H₀，认为时段对行车时间有显著影响。


 路段$P_b$=3.71*10^(-6)<0.05,拒绝H₀，认为路段对行车时间有显著影响。


 时段和路段的交互作用$P_ab$=0.997>0.05,不拒绝H₀，即不认为时段和路段的交互作用对行车时间有显著影响。


### 计算偏效应量并进行分析。

```{r}
model_5wi<-aov(行车时间~时段 + 路段 + 时段:路段,data=exercise8_5)
library(DescTools)
EtaSq(model_5wi,anova=T)
```
 
 由交互作用效应量分析结果可知：
 时段的$\eta^2$(偏效应量)=0.7455777387，即组间差异较大。
 路段的$\eta^2$=0.6472503358，即组间差异较大。
 时段和路段的交互作用的$\eta^2$=0.0002438925，即组间差异较小。

## 为检验广告媒体和广告方案对产品销量的影响，一家营销公司做了一项实验，考察三种广告方案和两种广告媒体，获得的数据如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_6.RData?raw=True")
exercise8_6
```
### 检验广告方案，广告媒体及其相互作用对销售量的影响是否显著（α=0.05）

 H₀：广告方案对销售量的影响不显著
 H₁：广告方案对销售量的影响显著

 H₀：广告媒体对销售量的影响不显著
 H₁：广告媒体对销售量的影响显著

 H₀：交互效应对销售量的影响不显著
 H₁：交互效应对销售量的影响显著
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_6.RData?raw=True")
mode2<-aov(销售量~广告方案+广告媒体+广告方案:广告媒体,data=exercise8_6)
summary(mode2)
mode2$coefficients
```
 分析:关于广告方案的p-value=0.0104<0.05，则拒绝H₀，认为广告方案对销售量的影响显著；
 关于广告媒体的p-value=0.1340>0.05，则不能拒绝H₀，即不能认为广告媒体对销售量的影响显著；
 交互效应 p-value=0.251>0.05，则不能拒绝H₀，即不能认为交互效应对销售量的影响不显著


### 计算偏效应量并进行分析
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch8/exercise8_6.RData?raw=True")
model_2wi<-aov (销售量~广告方案+广告媒体+广告方案:广告媒体,data=exercise8_6)
library(DescTools) 
EtaSq(model_2wi,anova=T) 
```
 分析:结果表明，在排除广告媒体和交互效应的影响后，广告方案解释了销售量误差的63.24%;
 在排除广告方案和交互效应的影响后，广告媒体解释了销售量误差的8.82%;
 在排除广告媒体和广告方案的影响后，交互效应解释了销售量误差的10.29%。

# 第九章 一元线性回归
## 下面是我国31地区2013年的居民消费水平和人均GDP数据。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch9/exercise9_1.RData?raw=True")
head(exercise9_1,10)
```

### 绘制散点图，判断人均GDP与居民消费水平之间的关系，并计算相关系数分析其关系强度。
```{r, fig.height = 3, fig.width = 4}
library(car)
scatterplot(居民消费水平~人均GDP,data=exercise9_1,col="black",pch=19,xlab="人均GDP",ylab="居民消费水平",cex.lab=0.8)
cor(exercise9_1[,2],exercise9_1[,3])
```

  结论;散点图显示，人均GDP增加，居民消费水平也随之增加。二者的观测点分布在一条直线周围，因而具有正的线性相关关系。人均GDP与居民消费水平之间的相关系数为0.9240374，所以两者之间具有较强的相关性。

### 以居民消费水平为因变量、人均GDP为自变量建立回归模型，并对回归模型进行综合评价。
```{r}
model<-lm(居民消费水平~人均GDP,data=exercise9_1)
summary(model)
confint(model,level=0.95)
anova(model)
```

  综合评价;回归系数为0.3194，对回归系数进行显著性检验，其P值=1.227x10^(-13)< 0.05,所以两者之间的线性关系显著。对模型进行拟合度检验，P值=0.227x10^ (-13)<0.05，证明模型拟合效果很好。
  
## 从某一行业中随机抽取12家企业，得到产量与生产费用数据如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch9/exercise9_2.RData?raw=True")
exercise9_2
```

### 绘制产量与生产费用的散点图，判断二者之间的关系形态。
```{r, fig.height = 3, fig.width = 4}
library(car)
attach(exercise9_2)
scatterplot(产量~生产费用,data=exercise9_1,col="black",pch=19,xlab="生产费用",ylab="产量",cex.lab=0.8)
```


  结论：散点图显示，随着生产费用增加，产量也随之增加。二者的观测点分布在一条直线周围，因而具有正的线性相关关系。


### 计算产量与生产费用之间的线性相关系数，对相关系数的显著性进行检验，并解释二者之间的关系强度
```{r}
cor(exercise9_2[,2],exercise9_2[,3]) 
cor.test(exercise9_2[,2],exercise9_2[,3])
```
  
  结论：产量和生产费用之间的相关系数为0.9202324，表明两者之间具有很强的相关性对相关系数进行检验，P值=2.222(*)10^(-5)<0.05，拒绝原假设，即认为两变量之间线性关系显著。

## 随机抽取10家航空公司，对其最近一年的航班准点率和顾客投诉次数进行调查，所得数据如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch9/exercise9_3.RData?raw=True")
exercise9_3
```
### 用航班准点率作自变量，顾客投诉次数作因变量，求出估计的回归方程，并解释回归系数的意义。
```{r}
model3<-lm(投诉次数~航班准点率,data=exercise9_3)
model3
```

  结论：估计的回归方程为$\hat{y}$=-4.701x+430.189。回归系数为-4.701，表示航班准点率每提高一个百分点，投诉次数便下降4.7006次。

### 检验回归系数的显著性
```{r}
summary(model3)
```

  结论：检验结果可知F=24.59，P值=0.001108<0.05，所以拒绝原假设，认为两个变量之间线性关系显著。

## 如果航班准点率为80%，估计顾客的投诉次数。
```{r}
p1=(-4.701)*80+430.189
p1
```

  结论：如果航班准点率为80%，估计顾客的投诉次数为54.109次。

## 随机抽取7家超市，得到其广告费支出和销售额数据如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch9/exercise9_4.RData?raw=True")
exercise9_4
```

  结论：用广告费支出作自变量x，销售额做因变量y建立回归模型，并对模型进行诊断和评价。

### 在一元线性回归模型中，首先假定y与x之间是线性关系，同时假定eta是期望值为0、方差相等且服从正态分布的独立随机变量。模型诊断就要针对以上问题进行诊断。
```{r, fig.height = 3, fig.width = 4}
model4<-lm(销售额~广告费支出,data=exercise9_4)
par(mfrow=c(2,2),mar=c(2.0,2.0,1.8,1.5),cex=0.8,cex.main=0.6)
plot(model4)
library(car)
durbinWatsonTest(model4)
```

  结论:由NormalQ-Q图可知，该模型残差基本符合正态性假定。由ResidualsvsFitted图可知，广告费支出和销售额之间为线性关系的假定成立。由Scale-Location图可知，该模型关于eta方差齐性的假定基本成立。残差独立性检验中，P值=0.086>0.05，所以不拒绝原假设，显示残差无自相关。

# 第十章 多元线性回归

## 一家电器销售公司的管理人员认为，每月的销售收入是广告费用的函数，并想通过广告费用对月销售收入进行估计，下面是近8个月的销售收入与广告费用数据：

### 用电视广告费用和报纸广告费用作自变量，建立估计的回归方程，并说明回归系数的意义。
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch10/exercise10_1.RData?raw=True")
exercise10_1
model1<-lm(月销售收入~电视广告费用+报纸广告费用,data=exercise10_1)
summary(model1)
```

 令y表示月销售收入，$x_1$表示电视广告费用，$x_2$表示报纸广告费用
 由多元线性回归建模结果可知回归方程为：$\hat{y}$=832.3009+2.2902$x_1$+1.3010$x_2$
 各回归系数的实际意义为：
 $\beta_1$=2.2902表示，在报纸广告费用不变的条件下，电视广告费用每变动1万元，月销售收入平均变动2.2902万元；
 $\beta_2$=1.3010表示，在电视广告费用不变的条件下，报纸广告费用每变动1万元，月销售收入平均变动1.3010万元。

### 对回归模型做综合评估。

```{r}
confint(model1,level=0.95)
anova(model1)
```

 H₀:$\beta_i$=0(自变量$x_i$与因变量y没有线性关系)
 H₁:$\beta_i$≠0(自变量$x_i$与因变量y有线性关系)
 综合评估：对回归系数进行显著性检验，其P值=0.001865<0.05，所以月销售收入与电视广告费用和表示报纸广告费用之间线性关系显著；对模型进行拟合度检验，电视广告费用P值=0.001432<0.05，报纸广告费用P值=0.009761<0.05，证明模型拟合效果很好。


### 给定电视广告费用为30万元，报纸广告费用为20万元，求月销售收入95%的置信区间和预测区间。
```{r}
model1<-lm(月销售收入~电视广告费用+报纸广告费用,data=exercise10_1)
x0<-data.frame(电视广告费用=30,报纸广告费用=20)
predict(model1,data.frame(电视广告费用=30,报纸广告费用=20),interval="confidence",level=0.95)
predict(model1,data.frame(电视广告费用=30,报纸广告费用=20),interval="prediction",level=0.95)
```

  分析：由逐步回归预测结果可知：在电视广告费用为30万元和报纸广告费用为20万元时，月销售收入95%的置信区间为[919.4121,934.6403]和预测区间[908.8376,945.2148]。

## 某农场通过试验取得早稻收获量和春季降雨量和春季温度的数据如下
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch10/exercise10_2.RData?raw=True")
exercise10_2
```

### 建立早稻收获量对春季降雨量和春季温度的二元线性回归方程，并对回归模型的线性关系和回归系数进行检验（α=0.05），你认为模型中是否存在多重共线性

### 建立回归方程
```{r}
model2<-lm(收获量~降雨量+温度,data=exercise10_2)
summary(model2)
```

 令y=收获量，x~1~=降雨量，x~2~=温度，则回归方程为$\hat{y}$=-0.591+22.387$x_1$+327.672$x_2$
 回归系数显著性检验：
 H₀：线性关系不显著
 H₁：β~1~,β~2~至少有一个不等于0
 降雨量p-value=0.0801>0.05，温度p-value=0.0295<0.05，则降水量的影响是不显著的，温度的影响是显著的
 多重共线性：
 H₀：自变量x~i~与因变量y没有线性关系
 H₁：自变量x~i~与因变量y有线性关系
```{r}
library(psych)
corr.test(exercise10_2,use="complete")
```
        收获量 降雨量 温度
收获量   1.00   0.98 0.99
降雨量   0.98   1.00 0.97
温度     0.99   0.97 1.00


### 比较降雨量和温度在预测收获量中的相对重要性
```{r}
attach(exercise10_2)
model2<-lm(收获量~降雨量+温度,data=exercise10_2)
library(lm.beta)
model1.beta<-lm.beta(model1)
summary(model1.beta)
```

 分析：结果显示各标准化回归系数为：0.4146，0.5896，β~2~的相对重要性大于β~1~,即降雨量对收获量的预测更重要。


## 为分析影响不良贷款的因素，一家商业银行在所属的多家分行中随机抽取25家，得到不良贷款、贷款余额、应收贷款、贷款项目个数、固定资产投资等有关数据如下：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch10/exercise10_3.RData?raw=True")
head(exercise10_3,10)
```

### 用不良贷款作因变量，建立多元线性回归模型。
```{r}
attach(exercise10_3)
model3=lm(不良贷款~贷款余额+应收贷款+贷款项目个数+固定资产投资,data=exercise10_3)
summary(model3)
```

 分析：贷款余额用建立的多元线性回归方程为$\hat{y}=0.04X_1+0.15X_2+0.014X_3-0.03X_4-1.02$


### 分析模型中是否存在共线性。
### 采用对模型中各自变量之间的相关系数进行检验的方法识别多重共线性
```{r}
library(psych)
corr.test(exercise10_3[2:5],use="complete")
```


### 用逐步回归方法建立回归模型
```{r}
model3.1=step(model3)
```

  分析:从逐步回归结果中，选择全部自变量时AIC=33.22，去掉变量“贷款项目个数”之后ACI=31.26，之后去掉任何一个解释变量ACI都会变大，故最终模型中保留“应收账款”、“固定资产投资”、“贷款余额”三个解释变量。


### 比较4个自变量在不良贷款中的相对重要性
```{r}
library(lm.beta)
model3.beta=lm.beta(model3)
summary(model3.beta)
```

 分析：各标准化的回归系数为：$\hat{\beta_1}=0.89131，\hat{\beta_2}=0.25982 ，\hat{\beta_3}= 0.03447 ，\hat{\beta_4}$= -0.32492 -0.32492$,所以贷款余额是预测不良贷款最重要的变量。

### 用anova和AIC两种方法对模型进行比较和分析
```{r}
model3_1=lm(不良贷款~贷款余额+应收贷款+贷款项目个数+固定资产投资,data=exercise10_3)
model3_2=lm(不良贷款~贷款余额+应收贷款+固定资产投资,data=exercise10_3)
anova(model3_2,model3_1)
AIC(model3_2,model3_1)
```

 分析:p-value=0.8629>0.05,表明两个变量之间无显著差异。

## 为分析某行业中薪水有无性别歧视。从该行业中速机抽取15名员工
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch10/exercise10_4.RData?raw=True")
exercise10_4
```

### 建立月薪与工龄的一元回归模型
```{r}
model<-lm(月薪~工龄,data=exercise10_4)
summary(model)
```

 分析：令y=月薪，x=工龄，则回归方程为：$\hat{y}$=327.2x+5249.7


### 建立月薪与工龄和性别的二元回归模型
```{r}
model4<-lm(月薪~工龄+性别,data=exercise10_4)
summary(model4)
```

 令 y=月薪，$x_1$=工龄，$x_2$=性别女，则回归方程为：$\hat{y}=111.22x_1+-458.68x_2+6190.74$


### 对两个模型进行比较，看看引入性别这一变量对预测月薪是否有用
##### H₀：β~2~=0
##### H₁：β~2~≠0
```{r}
model1<-lm(月薪~工龄+性别,data=exercise10_4) 
model2<-lm(月薪~工龄,data=exercise10_4)
anova(model2,model1)
```

 分析：p-value=1.823e-06<0.05,则拒绝原假设，认为引入性别这一变量对预测月薪是有用。



# 第十一章 时间序列预测
### 根据2006-2015年中国工业生产者出厂价格指数(PPI)数据(上年=100)，采用指数平滑法预测2016年的PPI，并对实际值和预测值绘图进行比较。
```{r, fig.height = 3, fig.width = 4}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch11/exercise11_1.RData?raw=True")
exercise11_1<-ts(exercise11_1,start=2006)
par(mai=c(0.6,0.6,0.12,0.1) ,cex=0.7)
plot(exercise11_1[,2],type='o',xlab="（a）年份",ylab="PPI")
cpiforecast<-HoltWinters(exercise11_1[,2],beta=FALSE,gamma=FALSE)
library(forecast)
cpiforecast<-forecast(cpiforecast,h=1)
cpiforecast
plot(cpiforecast,type='o',xlab="年份",ylab="PPI",main="")
```

 分析：图中折线是PPI的观测值，圆点是2016年的预测值，灰色区域是预测值的置信区间，其中浅灰色区域是95%的置信区间，深灰色区域是80%的置信区间。


## 根据1990-2010年我国原油产量数据，分别采用一元线性回归模型和Holt指数平滑模型预测2011年的原油产量，并绘制残差图对两种方法的预测效果进行比较。
### 一元线性回归模型
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch11/exercise11_2.RData?raw=True")
fit<-lm(原油产量~年份,data=exercise11_2)
summary(fit)
```

 分析：由结果可知一元线性回归预测方程为$\hat{Y_t}$=-571251.54+293.90t,则当t=2011时，$\hat{Y}_t$=19781.36。
### Holt指数平滑模型
```{r}
exercise11_2<-ts(exercise11_2,start=1990)
grainforecast<-HoltWinters(exercise11_2[,2],gamma=FALSE)
grainforecast
library(forecast)
grainforecast1<-forecast(grainforecast,h=1)
grainforecast1
```

 分析：由结果可知Holt指数平滑模型预测2011年的原油产量为20309.77。

### 绘制残差图对两种方法的预测效果进行比较
```{r, fig.height = 4, fig.width = 4}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch11/exercise11_2.RData?raw=True")
predata<-predict(fit,data.frame(年份=1990:2010)); predata#各年的预测值
res<-residuals(fit);res#各年的预测残差
residual1<-grainforecast1$residuals
fit<-lm(原油产量~年份,data=exercise11_2)
residual2<-fit$residuals
#par(mai=c(0.4,0.7,0.1,0.1),cex=0.8)
plot(as.numeric(residual1),ylim=c(-800,800),xlab="",ylab="残差",pch=1)
points(residual2,pch=2,col="red")
abline(h=0)
legend(x="topright",legend=c("Holt模型预测的残差","一元线性回归预测的残差"),pch=1:2,col=c("black","red"),cex=.8)
```


  分析：从残差图中可以看出，一元线性回归预测的残差和Holt模型预测的残差相差不大，所以选择任意一个模型预测均可。


## 下表是1991-2008年我国财政收入数据：
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch11/exercise11_3.RData?raw=True")
exercise11_3
```

### 分别采用Holt指数平滑模型和指数模型预测2009年的财政收入，并对实际值和预测值绘图进行比较
```{r, fig.height = 3, fig.width = 4}
exercise11_3<-ts(exercise11_3,start=1991)
forecast<-HoltWinters(exercise11_3[,2],gamma=FALSE)
forecast
library(forecast)
forecast1<-forecast(grainforecast,h=1)
forecast1
par(mai=c(.7,.7,.1,.1),cex=.9)
plot(forecast1,type='o',xlab="年份",ylab="财政收入" ,main="")
```


 Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
 3167.48       71943.02 69907.34 73978.69 68829.72 75056.32
 分析：采用Holt指数平滑模型预测2009年的财政收入为71943.02。
```{r, fig.height = 3, fig.width = 4}
exercise11_3<-ts(exercise11_3,start=1991)
forecast<-HoltWinters(exercise11_3[,2],beta=FALSE,gamma=FALSE)
forecast
library(forecast)
forecast1<-forecast(cpiforecast,h=1)
forecast1
plot(forecast1,type='o',xlab="年份",ylab="财政收入" ,main="")
```


 Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95


 3167.48       61329.89 56850.69 65809.09 54479.55 68180.23

 分析：采用指数模型预测2009年的财政收入为61329.89。

## 下面是某支股票连续35个交易日的收盘价格：分别拟合回归直线二次曲线和三次曲线，并绘制图像对结果进行比较
```{r,fig.height = 4, fig.width = 4}
library(repmis)
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch11/exercise11_4.RData?raw=True")
head(exercise11_4,10)
fit=lm(盘价格~时间,data=exercise11_4)  
summary(fit)
predata<-predict(fit,data.frame(时间=1:35)); predata
y<-exercise11_4[,2]
x<-1:35
fit1<-lm(y~x+I(x^2))
fit1
predata1<-predict(fit1,data.frame(x=1:35))
predata1
fit2<-lm(y~x+I(x^2)+I(x^3));fit2
predata2<-predict(fit2,data.frame(x=1:35))
predata2
residual2<-fit2$residuals
residual2
par(mfrow=c(2,2),mai=c(.6,.6,.4,.1),cex=.5)
plot(1:35,predata,type='o',lty=2,col="blue",xlab="时间",ylab="收盘价格")
lines(exercise11_4[,1],exercise11_4[,2],type='o',pch=19)
legend(x="topright",legend=c("观测值","预测值"),lty=1:5,cex=.7)
plot(1:35,predata1,type='o',lty=2,col="blue",xlab="时间",ylab="收盘价格")
lines(exercise11_4[,1],exercise11_4[,2],type='o',pch=19)
legend(x="topright",legend=c("观测值","预测值"),lty=1:5,cex=.7)
plot(1:35,predata2,type='o',lty=2,col="blue",xlab="时间",ylab="收盘价格")
lines(exercise11_4[,1],exercise11_4[,2],type='o',pch=19)
legend(x="topright",legend=c("观测值","预测值"),lty=1:5,cex=.7)
```

 分析:由图可以看出三次曲线拟合效果最好


## 下表是2009-2013年我国社会消费品零售总额
### 分别采用Winter指数平滑模型和分解法预测2014年各月份的社会消费品总额，并对实际值和预测值绘图，分析预测效果
```{r, fig.height = 3, fig.width = 4}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch11/exercise11_5.RData?raw=True")
exercise11_5<-ts(exercise11_5[,3],start=2009,frequency=12)
exercise11_5
saleforecast<-HoltWinters(exercise11_5)
saleforecast
library(forecast)
saleforecast1<-forecast(saleforecast,h=12)
saleforecast1
plot(saleforecast1,type='o',xlab="时间",ylab="销售量" ,main="")
```


 分析：采用Winter指数平滑模型预测2014年各月份的社会消费品总额结果如下：
 Point         Forecast 
 
Jan 2014       22503.39 

Feb 2014       21508.05 

Mar 2014       21216.85 

Apr 2014       21302.16 

May 2014       22468.82 


## 利用习题11.4的数据分别采用m=5和m=10对收盘价格进行平滑，并绘制出实际值与平滑值的图形进行比较
```{r}
source_data("https://github.com/yanliangs/Statistics-with-R/blob/master/exercise/ch11/exercise11_4.RData?raw=True")
head(exercise11_4,10)
```
```{r, fig.height = 3, fig.width = 4}
exercise11_4=ts(exercise11_4,start=1)
library(DescTools)
m5=MoveAvg(exercise11_4[,2],order=5,align="center",endrule="keep")
m10=MoveAvg(exercise11_4[,2],order=10,align="center",endrule="keep")
data.frame("时间"=exercise11_4[,1],"收盘价格"=exercise11_4[,2],m5,m10)
par(mai=c(0.7,0.7,0.1,0.1),cex=0.8)
plot(exercise11_4[,2],type='o',xlab="时间",ylab="收盘价格")
lines(m5,type="o",lty=2,col="red")
lines(m10,type="o",lty=6,col="blue")
legend(x="topleft",legend=c("收盘价格","m5","m10"),lty=c(1,2,6),col=c("black","red","blue"),cex=0.8)
```

 结论：m=10时的拟合度较好